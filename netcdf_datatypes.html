
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>The issue with netCDF data types &#8212; How to EUREC4A</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="shortcut icon" href="_static/logo_pyeurec4a.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data on IPFS" href="data_on_ipfs.html" />
    <link rel="prev" title="running How to EUREC4A locally" href="running_locally.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo_pyeurec4a.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">How to EUREC4A</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="halo.html">
   HALO
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="HALO_instrument_overview.html">
     Instrument Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="specmacs.html">
     specMACS cloudmask
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="unified.html">
     HALO UNIFIED dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="flight_tracks_leaflet.html">
     interactive HALO tracks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="smart.html">
     SMART dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="velox.html">
     VELOX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="bacardi.html">
     BACARDI dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wales.html">
     WALES Lidar
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hamp_comparison.html">
     HAMP comparison
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cloudmasks.html">
     Cloud masks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pthree.html">
   NOAA P3 “Miss Piggy”
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="p3_flight_tracks.html">
     Flight tracks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="p3_humidity_comparison.html">
     Humidity comparison: Hygrometer and isotope analyzer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="p3_wband_radar.html">
     W-band radar example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="p3_AXBTs.html">
     Ocean temperatures: AXBTs and SWIFT buoys
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="p3_wsra.html">
     WSRA example: surface wave state
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="meteor.html">
   Meteor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="meteor_cloudradar.html">
     Reading cloud radar data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="merian.html">
   Merian
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="merian_cloudradar.html">
     Cloud radar data collected on MS Merian
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="bco.html">
   BCO
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="bco_cloudradar.html">
     Cloud radar data collected at the Barbados Cloud Observatory (BCO)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="multi_platform_data.html">
   Multi-platform datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="dropsondes.html">
     Dropsondes dataset JOANNE
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="simulations.html">
   Simulations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="icon_les.html">
     ICON-LES
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="icon_les-pamtra.html">
       Synthetic measurements
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="auxiliary_datasets.html">
   Auxiliary datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="c3ontext.html">
     How to put your measurements into the meso-scale context of cloud patterns
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="toolbox.html">
   Toolbox
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="flight-phase-operations.html">
     How to work with flight phase segmentation files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="show_intake_catalog.html">
     Show the intake catalog
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cloud_stat_tools.html">
     Cloud statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="running_locally.html">
     running How to EUREC4A locally
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     The issue with netCDF data types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data_on_ipfs.html">
     Data on IPFS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stats.html">
   Script execution statistics
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/eurec4a/how_to_eurec4a"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/eurec4a/how_to_eurec4a/issues/new?title=Issue%20on%20page%20%2Fnetcdf_datatypes.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/eurec4a/how_to_eurec4a/edit/master/how_to_eurec4a/netcdf_datatypes.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/netcdf_datatypes.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-netcdf">
   What is netCDF?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-data-model-s">
     The data model(s)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-storage-and-transport-formats">
     The storage and transport formats
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#netcdf">
       netCDF
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#opendap">
       OPeNDAP
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#zarr">
       zarr
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-should-we-care">
   Why should we care?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-experiment">
   An experiment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     Results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#did-we-learn-something">
   Did we learn something?
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>The issue with netCDF data types</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-netcdf">
   What is netCDF?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-data-model-s">
     The data model(s)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-storage-and-transport-formats">
     The storage and transport formats
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#netcdf">
       netCDF
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#opendap">
       OPeNDAP
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#zarr">
       zarr
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-should-we-care">
   Why should we care?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-experiment">
   An experiment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     Results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#did-we-learn-something">
   Did we learn something?
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="the-issue-with-netcdf-data-types">
<h1>The issue with netCDF data types<a class="headerlink" href="#the-issue-with-netcdf-data-types" title="Permalink to this headline">#</a></h1>
<div class="tip admonition">
<p class="admonition-title">TL; DR</p>
<p>If you want to be on the safe side, use only <code class="docutils literal notranslate"><span class="pre">SHORT</span></code>, <code class="docutils literal notranslate"><span class="pre">INT</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code>, <code class="docutils literal notranslate"><span class="pre">STRING</span></code> or array of <code class="docutils literal notranslate"><span class="pre">CHAR</span></code> as data types.
In particular, <strong>don’t</strong> use single byte integers, any unsigned integer and no 64 bit integer.</p>
</div>
<p>The data format netCDF which is used in many places throughout our community has evolved over time.
During this evolution, the basic data types representable within the netCDF data format have been expanded.
Currently we are at netCDF version 4 with HDF5 as a storage backend, which offers a lot more flexibility compared to previous versions of netCDF including many more <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/docs/data_type.html">data types</a>.
One <strong>could</strong> assume that this is all fine and we can use these data types freely, but here we are unlucky and there is more to keep in mind.</p>
<p>In order to paint the full picture, we’ll have to take a little detour and think about what <a class="reference external" href="#what-is-netcdf">netCDF actually is</a> or even more what we think (or probably should think) about when talking about netCDF.
As we’ll see, this is not something which can be answered in a straight forward manner, so it is fair to ask <a class="reference external" href="#why-should-we-care">if we should care at all</a>.
Finally we’ll have a look at <a class="reference external" href="#an-experiment">an experiment</a> which shows plenty of ways in which different data types may fail around netCDF and which types seem to be fine.</p>
<section id="what-is-netcdf">
<h2>What is netCDF?<a class="headerlink" href="#what-is-netcdf" title="Permalink to this headline">#</a></h2>
<p>NetCDF is more than only the “netCDF4 on HDF5” storage format.
This is not only a bold statement, but is actually asked and discussed by the netCDF developers (<a class="reference external" href="https://github.com/Unidata/netcdf-c/issues/1590">What is netCDF?</a>, Jan 2020).
This chapter is not exactly about the same topic in the referenced issue, but still has similar roots.
The relevant part for this discussion is that there is at least netCDF, the <strong>data model</strong> and netCDF, the <strong>persistence format</strong>.
It is also recognized that there are multiple persistence formats (netCDF3, netCDF4/HDF5, zarr) for the same data model and there are translation layers such as OPeNDAP which can be used as a transport mechanism between the computer on which data is stored and the computer on which data is analyzed.
We further look at the relevance of the netCDF data model and netCDF persistence format for the EUREC4A datasets.</p>
<section id="the-data-model-s">
<h3>The data model(s)<a class="headerlink" href="#the-data-model-s" title="Permalink to this headline">#</a></h3>
<p>There are actually a few different ideas of data models around, which share some general ideas.
Maybe the most illustrative way to show this general idea is an extended version of <a class="reference external" href="http://xarray.pydata.org/">xarray</a>’s logo, but the underlying ideas are of course applicable independently of xarray or even Python.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/dataset-diagram.png"><img alt="dataset diagram" src="_images/dataset-diagram.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Dataset diagram (From the <a class="reference external" href="http://xarray.pydata.org/en/stable/data-structures.html">xarray documentation</a>)</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>A dataset is a collection of <em>variables</em> and <em>dimensions</em>.
Variables are multi-dimensional arrays and they can share dimensions (i.e. to express that <code class="docutils literal notranslate"><span class="pre">temperature</span></code> and <code class="docutils literal notranslate"><span class="pre">precipitation</span></code> are defined at the same locations, the three axes of the corresponding arrays should be identified with the same dimension label, that is e.g. <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code>).
Some variables may be promoted into a <em>coordinate</em>, which does not require to store it differently, but it changes the interpretation of the data.
In the example above, <code class="docutils literal notranslate"><span class="pre">latitude</span></code> and <code class="docutils literal notranslate"><span class="pre">longitude</span></code> would likely be identified as coordinates.
One would typically use <em>coordinate</em> values to index into some data or to label the ticks on a plot axis, while a normal <em>variable</em> would usually be used to define a line or a color within a plot.
There may be <em>variables</em> which should be <em>coordinates</em> only for a specific use case and vice versa.
It is useful to distinguish between <em>variables</em> and <em>coordinates</em> within the metadata of a dataset, but the representation of the actual data may be the same for both, <em>variables</em> and <em>coordinates</em>.
In addition to the existence of <em>coordinates</em>, there are more pieces of valuable additional information (think of units, coordinate reference systems, author information etc…).
Thus we usually want those extra bits to datasets and variables, which can be done by the use of <em>attributes</em>.</p>
<p>It turns out that many datasets in the EUREC4A context can be represented very well in this model.
I assume that in many cases when we talk about that a dataset being available in netCDF, what we really care about is that the dataset is organized along this general structure and thus can be accesses <em>as if it were netCDF</em>.</p>
</section>
<section id="the-storage-and-transport-formats">
<h3>The storage and transport formats<a class="headerlink" href="#the-storage-and-transport-formats" title="Permalink to this headline">#</a></h3>
<section id="netcdf">
<h4>netCDF<a class="headerlink" href="#netcdf" title="Permalink to this headline">#</a></h4>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>NetCDF defines two internal “data models”, thus they could go into the section above.
However, those models are also loosely tied to their backend storage formats and thus, they might fit better in the current paragraph.</p>
</div>
</aside>
<p>In order to put the high level idea from above into a data structure which can be stored on disk, netCDF defines two low level data models where the <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/docs/netcdf_data_model.html#classic_model">Classic</a> data model came first and the <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/docs/netcdf_data_model.html#enhanced_model">Enhanced</a> data model evolved from it.
Both models care about <em>variables</em>, <em>dimensions</em> and <em>attributes</em> as introduced above.</p>
<p>Those two data models are closely tied to the netCDF3 and netCDF4 storage formats.</p>
<ul class="simple">
<li><p>netCDF3 is based on the <em>classic</em> data model and defines a storage format which is custom to netCDF.</p></li>
<li><p>netCDF4 is based on the <em>enhanced</em> data model and uses HDF5 as its backend storage format. HDF5 enables further enhancements like internal data compression.</p></li>
</ul>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>HDF5 features <code class="docutils literal notranslate"><span class="pre">external</span></code> and <code class="docutils literal notranslate"><span class="pre">virtual</span></code> datasets which <a class="reference external" href="https://github.com/Unidata/netcdf-c/pull/1828">can be</a> compatible to netCDF4 but can not be written using netCDF4 API.</p>
</div>
</aside>
<p>Both storage formats store all data in a single file, chunking of the dataset is done internally.
If the dataset should be accessed from a remote location, usually the entire dataset must be fetched before accessing the data.</p>
<p>In Jan 2019 <a class="reference external" href="https://github.com/Unidata/netcdf-c/pull/1267">HTTP byte-range</a> enabled partial reads from remote datasets have been added to netCDF-c, but as stated in the pull request, it is not meant for production use:</p>
<blockquote>
<div><p>Note that this is not intended as a true production
capability because, as is known, this kind of access to
can be quite slow. In addition, the byte-range IO drivers
do not currently do any sort of optimization or caching.</p>
</div></blockquote>
<p>Thus, if a dataset should be accessed efficiently from a remote location, something different must be added, which is what OPeNDAP is for.</p>
</section>
<section id="opendap">
<h4>OPeNDAP<a class="headerlink" href="#opendap" title="Permalink to this headline">#</a></h4>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Datacenters used by EUREC4A provide data via OPeNDAP include Aeris, NOAA PSL, NOAA NCEI, MPIM RAMADDA and the specMACS macsServer. The How to EUREC4A book makes use of this service to access the various datasets.</p>
</div>
</aside>
<p><a class="reference external" href="https://www.opendap.org">OPeNDAP</a> is a network protocol to access scientific data via network.
In particular, it uses HTTP as a transport mechanism and defines a way to request subsets of a dataset which is formed along the data model as described above.
OPeNDAP is thus the go-to method if an existing netCDF dataset should be made available remotely.
In the context of EUREC4A, most datacenters provide access to uploaded datasets via OPeNDAP.</p>
<p>OPeNDAP is specified in two versions, namely <a class="reference external" href="https://www.opendap.org/pdf/ESE-RFC-004v1.2.pdf">version 2</a> and <a class="reference external" href="https://www.opendap.org/pdf/dap_objects.pdf">version 4</a>.
However, DAP4 is still a draft since 2004 and the only widely supported version of OPeNDAP is version 2.</p>
<p>The data model of OPeNDAP v2 is slightly different from the data model in netCDF.
Regarding data types, OPeNDAP v2 defines <code class="docutils literal notranslate"><span class="pre">Byte</span></code>, <code class="docutils literal notranslate"><span class="pre">Int16</span></code>, <code class="docutils literal notranslate"><span class="pre">UInt16</span></code>, <code class="docutils literal notranslate"><span class="pre">Int32</span></code>, <code class="docutils literal notranslate"><span class="pre">UInt32</span></code>, <code class="docutils literal notranslate"><span class="pre">Float32</span></code>, <code class="docutils literal notranslate"><span class="pre">Float64</span></code>, <code class="docutils literal notranslate"><span class="pre">String</span></code>, <code class="docutils literal notranslate"><span class="pre">URL</span></code>.</p>
<p>As opposed to the <code class="docutils literal notranslate"><span class="pre">BYTE</span></code> in netCDF Classic, the <code class="docutils literal notranslate"><span class="pre">Byte</span></code> in OPeNDAP is <strong>unsigned</strong>.
This makes byte types of netCDF Classic and OPeNDAP incompatible, but as noted in the <a class="reference external" href="#summary">summary</a>, there exists a hack which tries to circumvent that.
One could assume that <code class="docutils literal notranslate"><span class="pre">UBYTE</span></code> of netCDF Enhanced would fit to this <code class="docutils literal notranslate"><span class="pre">Byte</span></code>, but there are issues as well which are confirmed in <a class="reference external" href="#an-experiment">the experiment</a>.</p>
<p>Furthermore, there is no <code class="docutils literal notranslate"><span class="pre">CHAR</span></code>, so whenever a netCDF dataset containing text as a sequence of <code class="docutils literal notranslate"><span class="pre">CHAR</span></code> is encountered by an OPeNDAP server, this will be converted to an OPeNDAP <code class="docutils literal notranslate"><span class="pre">String</span></code>.
A consequence of this is that <code class="docutils literal notranslate"><span class="pre">CHAR</span></code>s and <code class="docutils literal notranslate"><span class="pre">STRING</span></code>s can not be distinguished when transferred over OPeNDAP and thus may be converted into each other after one cycle through netCDF → OPeNDAP → netCDF.
This behaviour is not (yet) studied in this text.</p>
</section>
<section id="zarr">
<h4>zarr<a class="headerlink" href="#zarr" title="Permalink to this headline">#</a></h4>
<div class="caution admonition">
<p class="admonition-title">to do</p>
<p><a class="reference external" href="https://zarr.readthedocs.io/">zarr</a> should be discussed in this place.</p>
</div>
</section>
</section>
</section>
<section id="why-should-we-care">
<h2>Why should we care?<a class="headerlink" href="#why-should-we-care" title="Permalink to this headline">#</a></h2>
<p>Each of the formats has distinct advantages and disadvantages:</p>
<ul class="simple">
<li><p><strong>netCDF</strong> is a compact format, the whole dataset can be stored in a single file which can be transferred from one place to another and everything is contained. This is great for storing data and to send around smaller datasets, but retrieving only a subset of a dataset from a remote server is not possible. Libraries which can open netCDF files usually do not handle HTTP, so the dataset needs to be stored in a local directory to use it.</p></li>
<li><p><strong>OPeNDAP</strong> is a network protocol based on HTTP which has been made exactly for the purpose of requesting subsets of a dataset from a remote server. As it is only a network protocol, it can not be used to store the data, so every dataset which should be provided via OPeNDAP must be stored in another format (like netCDF) or computed on the fly. Support for reading OPeNDAP is build into netCDF-c.</p></li>
<li><p><strong>zarr</strong> is a storage format which is spread out into several files in a defined directory structure. This makes it a little harder to pass around, but this chunked structure makes remote access exceptionally simple and fast. Chelle Gentemann has prepared an <a class="reference external" href="https://nbviewer.jupyter.org/github/oceanhackweek/ohw20-tutorials/blob/master/10-satellite-data-access/goes-cmp-netcdf-zarr.ipynb">impressive demonstration</a> on this topic.</p></li>
</ul>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>zarr can be used as a single file by using a zip file as its directory structure.</p>
</div>
</aside>
<p>So, depending on the use case, different formats are optimal and none of them supports everything:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>format</p></th>
<th class="head"><p>for storage</p></th>
<th class="head"><p>sending around</p></th>
<th class="head"><p>for remote access</p></th>
<th class="head"><p>widely supported</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>netCDF</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌, works via OPeNDAP</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-odd"><td><p>OPeNDAP</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>✅, can share netCDF</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-even"><td><p>zarr</p></td>
<td><p>✅</p></td>
<td><p>moderate</p></td>
<td><p>✅, with high performance</p></td>
<td><p>❌, netCDF-c is working on it</p></td>
</tr>
</tbody>
</table>
<p>Thus, if we want to have datasets which can be used locally as well as remotely (some might call it “in the cloud”), we should take care that our datasets are convertible between those formats so that we can adapt to the specific use case.</p>
</section>
<section id="an-experiment">
<h2>An experiment<a class="headerlink" href="#an-experiment" title="Permalink to this headline">#</a></h2>
<p>Currently, the main use case for the Aeris data server is to publish netCDF files and retrieve them back, either via direct download or via OPeNDAP.
This experiment is designed to test under which circumstances data which has been created as netCDF can be retrieved correctly via OPeNDAP.
In order to minimize additional problems due to the mix of incompatible libraries, all dataset decoding is done using the same netCDF-c library (independent of the access to the dataset, directly or via OPeNDAP).</p>
<p>The individual test cases show differences between data types, the use of negative numbers, the use of values used as numeric values, and the use of values interpreted as flags.
For each data type, there is a drop down menu which shows the individual sub cases.
If any one of the sub cases failed, the data type is marked as erroneous.</p>
<p>In each case the test follows the same steps:</p>
<ul class="simple">
<li><p>The original dataset is dumped via <code class="docutils literal notranslate"><span class="pre">ncdump</span></code></p></li>
<li><p>The OPeNDAP dataset attribute structure (<code class="docutils literal notranslate"><span class="pre">.das</span></code>) is retrieved via <code class="docutils literal notranslate"><span class="pre">curl</span></code> to look at the raw response of the server</p></li>
<li><p>The dataset as received via OPeNDAP is dumped via <code class="docutils literal notranslate"><span class="pre">ncdump</span></code></p></li>
<li><p>A little script checks if it detects any significant error between the original and the OPeNDAP dataset</p></li>
</ul>
<section id="results">
<h3>Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h3>
<div class="dropdown error admonition">
<p class="admonition-title">BYTE</p>
</div>
<div class="dropdown error admonition">
<p class="admonition-title">UBYTE</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">SHORT</p>
</div>
<div class="dropdown error admonition">
<p class="admonition-title">USHORT</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">INT</p>
</div>
<div class="dropdown error admonition">
<p class="admonition-title">UINT</p>
</div>
<div class="dropdown error admonition">
<p class="admonition-title">INT64</p>
</div>
<div class="dropdown error admonition">
<p class="admonition-title">UINT64</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">FLOAT</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">DOUBLE</p>
</div>
</section>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h3>
<p>The result of this experiment is underwhelming but shows a clear picture.
A large set of data types can not be used reliably in a combination of netCDF and OPeNDAP.
The failure modes however differ significantly between the various types:</p>
<ul class="simple">
<li><p>64 bit integers simply can not be encoded in XDR which is the binary encoding of OPeNDAP. Thus the server just fails and the user receives an error.</p></li>
<li><p>unsigned short and unsigned int could be represented by OPeNDAP in principle, however the Server introduces spurious <code class="docutils literal notranslate"><span class="pre">_FillValue</span></code>s which additionally are of the wrong (signed) integral type such that the netCDF client library refuses to read the data. This is most likely a Bug in the specific server.</p></li>
<li><p>unsigned bytes could in principle be represented by OPeNDAP, but the values received by the client are wrong. This might be an attempt by the client to somehow handle the erroneously delivered <code class="docutils literal notranslate"><span class="pre">valid_range</span></code>. The big problem here is that this can result in an <strong>error without a message</strong>.</p></li>
<li><p>signed bytes can work sometimes even if they are <strong>not representable</strong> by OPeNDAP. This is due to a <a class="reference external" href="https://github.com/Unidata/netcdf-c/pull/1317"><strong>hack</strong></a> which has been introduced into netCDF-c which is based on the use of the additional <code class="docutils literal notranslate"><span class="pre">_Unsigned</span></code> attribute which is created automatically by the server. The hack however only applies to the data values and not to the attributes. As a consequence, the data type of the attributes may be changed <strong>depending on the values</strong> stored in the attributes. In particular, <strong>signed</strong> bytes seem to work <strong>only if they are positive</strong>. The behaviour is however really weird, so maybe one should not count on it.</p></li>
</ul>
<p>As a <strong>consequence</strong>, the only numeric data types which should be used in any dataset are <code class="docutils literal notranslate"><span class="pre">SHORT</span></code>, <code class="docutils literal notranslate"><span class="pre">INT</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> and <code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code>.
<code class="docutils literal notranslate"><span class="pre">STRING</span></code> and <code class="docutils literal notranslate"><span class="pre">CHAR</span></code> (when used as text) seem to be ok, but they have not been investigated in this setting yet.</p>
</section>
</section>
<section id="did-we-learn-something">
<h2>Did we learn something?<a class="headerlink" href="#did-we-learn-something" title="Permalink to this headline">#</a></h2>
<p>Well, it depends.
In principle, these results are also present, but well hidden inside the <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/documentation/NUG/index.html">NetCDF Users Guide</a>:
The <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/documentation/NUG/_best_practices.html">Best Practices</a> state:</p>
<blockquote>
<div><ul class="simple">
<li><p>Do not use char type variables for numeric data, use byte type variables instead.</p></li>
</ul>
<p>[…]</p>
<p>NetCDF-3 does not have unsigned integer primitive types.</p>
<ul class="simple">
<li><p>To be completely safe with unknown readers, widen the data type, or use floating point.</p></li>
</ul>
</div></blockquote>
<p>This excludes the use of <code class="docutils literal notranslate"><span class="pre">CHAR</span></code> for numeric applications and effectively also <code class="docutils literal notranslate"><span class="pre">BYTE</span></code>, <code class="docutils literal notranslate"><span class="pre">UBYTE</span></code>.</p>
<p>And in the <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/docs/netcdf_data_model.html">data model section</a> we can find:</p>
<blockquote>
<div><p>For maximum interoparability with existing code, new data should be created with the The Classic Model.</p>
</div></blockquote>
<p>This excludes the use of 64 bit integers and unsigned types.</p>
<p>Thus, the take-home message of this article is not new, everything could have been found in the NetCDF Users Guide.
However at least I was not fully aware of all of these implications and did only find the references into the Users Guide while preparing this article.
I think if we want to provide datasets which are usable by everyone, the insights of this article are important to share.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "eurec4a/how_to_eurec4a",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="running_locally.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">running How to EUREC4A locally</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="data_on_ipfs.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Data on IPFS</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By EUREC4A community<br/>
  
      &copy; Copyright 2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>